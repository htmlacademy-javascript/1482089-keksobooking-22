(()=>{"use strict";const e=35.683377,t=139.754519,r=["12:00","13:00","14:00"],o={bungalow:0,flat:1e3,house:5e3,palace:1e4},l="any",a=["jpg","jpeg","png"],n=500;let c=document.querySelector("#card").content.querySelector(".popup"),u=document.querySelector("#housing-type"),d=document.querySelector("#housing-price"),s=document.querySelector("#housing-rooms"),i=document.querySelector("#housing-guests"),p=document.querySelector("#housing-features"),f=(e,t)=>{t.addEventListener("change",(()=>{document.querySelectorAll(".leaflet-marker-icon:not(:first-of-type)").forEach((e=>{e.remove()}));let t=document.querySelector(".leaflet-popup");t&&(t.style.display="none"),e()}))},m=function(e){return u.value===e.offer.type||u.value===l},y=e=>{switch(d.value){case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<5e4;case"high":return e.offer.price>=5e4;default:return!0}},h=e=>e.offer.rooms>=s.value||s.value===l,g=e=>e.offer.guests>=i.value||i.value===l,v=e=>{let t=p.querySelectorAll("input:checked");return e.offer.features.every.call(t,(function(t){return-1!==e.offer.features.indexOf(t.value)}))},S=document.querySelector(".ad-form"),q=S.querySelectorAll("fieldset"),b=document.querySelector(".map__filters"),E=b.querySelectorAll(".map__filter"),x=b.querySelector(".map__features"),k=document.querySelector(".map__canvas"),C=S.querySelector("#address"),w=e=>{e?(S.classList.add("ad-form--disabled"),q.forEach((e=>{e.disabled=!0})),x.disabled=!0,b.classList.add("map__filters--disabled"),E.forEach((e=>{e.disabled=!0}))):(S.classList.remove("ad-form--disabled"),q.forEach((e=>{e.disabled=!1})),x.disabled=!1,b.classList.remove("map__filters--disabled"),E.forEach((e=>{e.disabled=!1})))};w(!0);let A=L.map(k).on("load",(()=>{w(!1)})).setView({lat:e,lng:t},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(A);let N=L.icon({iconUrl:"img/main-pin.svg",iconSize:[60,60],iconAnchor:[30,60]}),j=L.marker({lat:e,lng:t},{icon:N,draggable:!0}).addTo(A),F=j.getLatLng(),O=Number(F.lat.toFixed(5)),V=Number(F.lng.toFixed(5));C.readOnly=!0,C.value=`${O}, ${V}`,j.on("move",(e=>{let t=e.target.getLatLng(),r=Number(t.lat.toFixed(5)),o=Number(t.lng.toFixed(5));C.value=`${r}, ${o}`}));let D=L.icon({iconUrl:"img/pin.svg",iconSize:[60,60],iconAnchor:[30,60]}),z=document.querySelector("#housing-type"),T=document.querySelector("#housing-price"),$=document.querySelector("#housing-rooms"),R=document.querySelector("#housing-guests"),U=document.querySelector("#housing-features"),P=e=>{e.slice().filter(m).filter(y).filter(h).filter(g).filter(v).slice(0,10).forEach((e=>{let t=e.location.lat,r=e.location.lng;L.marker({lat:t,lng:r},{icon:D}).addTo(A).bindPopup((e=>{let t=c.cloneNode(!0),r=t.querySelector(".popup__title"),o=t.querySelector(".popup__text--address"),l=t.querySelector(".popup__text--price"),a=t.querySelector(".popup__type"),n=t.querySelector(".popup__text--capacity"),u=t.querySelector(".popup__text--time"),d=t.querySelector(".popup__features"),s=d.children,i=t.querySelector(".popup__description"),p=t.querySelector(".popup__photos"),f=p.querySelector(".popup__photo"),m=t.querySelector(".popup__avatar");r.textContent=e.offer.title,o.textContent=e.offer.address,l.textContent=e.offer.price+" ₽/ночь",a.textContent=(e=>{let t="Квартира";return"bungalow"===e.offer.type&&(t="Бунгало"),"house"===e.offer.type&&(t="Дом"),"palace"===e.offer.type&&(t="Дворец"),t})(e);let y=" комната для ",h=" гостя";e.offer.rooms>1&&(y=" комнаты для "),e.offer.rooms>4&&(y=" комнат для "),e.offer.guests>1&&(h=" гостей"),n.textContent=e.offer.rooms+y+e.offer.guests+h,u.textContent="Заезд после "+e.offer.checkin+" выезд до "+e.offer.checkout;for(let e=s.length-1;e>=0;e--)s[e].remove();e.offer.features.forEach((e=>{let t=document.createElement("li");t.classList.add("popup__feature");let r=`popup__feature--${e}`;t.classList.add(r),d.appendChild(t)})),i.textContent=e.offer.description;for(let t=0;t<e.offer.photos.length;t++){let r=f.cloneNode(!0);r.src=e.offer.photos[t],p.appendChild(r)}return p.children[0].remove(),0===p.children.length&&p.remove(),m.src=e.author.avatar,"img/avatars/user0undefined.png"===e.author.avatar&&m.remove(),t})(e))}))};re((e=>{P(e),f(_.debounce((()=>{P(e)}),n),z),f(_.debounce((()=>{P(e)}),n),T),f(_.debounce((()=>{P(e)}),n),$),f(_.debounce((()=>{P(e)}),n),R),f(_.debounce((()=>{P(e)}),n),U)}));let I=document.querySelector("#avatar"),M=document.querySelector(".ad-form-header__preview:first-child").querySelector("img"),W=e=>a.some((t=>e.endsWith(t)));I.addEventListener("change",(()=>{let e=I.files[0],t=e.name.toLowerCase();if(W(t)){let t=new FileReader;t.readAsDataURL(e),t.addEventListener("load",(()=>{M.src=t.result}))}}));let B=document.querySelector("#images"),G=document.querySelector(".ad-form__photo"),H=document.querySelector(".ad-form__photo-container");B.addEventListener("change",(()=>{let e=B.files;for(let t=0;t<e.length;t++){let r=e[t],o=r.name.toLowerCase();if(W(o)){let e=new FileReader;e.readAsDataURL(r);let t=G.cloneNode(!0),o=document.createElement("img");o.style.width="100%",o.style.height="100%",t.appendChild(o),H.appendChild(t),G.remove(),e.addEventListener("load",(()=>{o.src=e.result}))}}}));let J=document.querySelector(".ad-form__reset"),K=()=>{document.querySelectorAll(".ad-form__photo").forEach((e=>{e.remove()})),H.appendChild(G),M.src="img/muffin-grey.svg"};function Q(){let e=document.createElement("div");e.style.height="50px",e.style.textAlign="center",e.style.backgroundColor="#ffaa99",e.style.position="fixed",e.style.padding="10px",e.style.fontSize="20px",e.style.top=0,e.style.right=0,e.style.left=0,e.textContent="Ошибка загрузки данных с сервера",document.body.appendChild(e),setTimeout((()=>{e.remove()}),3e3)}J.addEventListener("click",K);let X=e=>{let t=e.querySelector("button");e.contains(t)&&t.addEventListener("click",(()=>{e.remove()})),e.addEventListener("click",(()=>{e.remove()})),document.addEventListener("keydown",(t=>{27===t.keyCode&&e.remove()}))},Y=(e,t)=>{let r=document.querySelector(e).content.querySelector(t).cloneNode(!0),o=document.querySelector("main");return o.querySelector(".map").style.zIndex="1",o.appendChild(r)},Z=()=>{let r=document.querySelector(".map__filters"),o=document.querySelector(".ad-form"),l=o.querySelector("#address");o.reset(),r.reset(),l.value="35.683377, 139.754519",j.setLatLng([e,t])},ee=()=>{Z(),K();let e=Y("#success",".success");X(e)},te=()=>{let e=Y("#error",".error");X(e)};function re(e){fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((t=>{e(t)})).catch(Q)}let oe=Object.keys(o),le=Object.values(o),ae=document.querySelector(".ad-form"),ne=ae.querySelector("#type"),ce=ae.querySelector("#price"),ue=ae.querySelector("#title");ce.placeholder=le[1],ce.min=le[1],ne.addEventListener("change",(()=>{for(let e=0;e<oe.length;e++)ne.value===oe[e]&&(ce.placeholder=le[e],ce.min=le[e])})),ce.addEventListener("input",(()=>{ce.value>1e6?ce.setCustomValidity("Максимальная цена 1.000.000"):ce.setCustomValidity(""),ce.reportValidity()})),ae.addEventListener("submit",(e=>{for(let t=0;t<oe.length;t++)ne.value===oe[t]&&ce.value<le[t]&&e.preventDefault()})),ue.addEventListener("input",(()=>{let e=ue.value.length;e<30?ue.setCustomValidity("Ещё "+(30-e)+" симв."):ue.setCustomValidity(""),ue.reportValidity()}));let de=ae.querySelector("#timein"),se=ae.querySelector("#timeout");de.addEventListener("change",(()=>{for(let e=0;e<r.length;e++)de.value===r[e]&&(se.value=r[e])})),se.addEventListener("change",(()=>{for(let e=0;e<r.length;e++)se.value===r[e]&&(de.value=r[e])}));let ie=ae.querySelector("#room_number"),pe=ae.querySelector("#capacity").querySelectorAll("option"),fe=(e,t)=>{for(let r=0;r<e.length;r++)e[r].disabled=!1,t.indexOf(e[r].value)>-1&&(e[r].disabled=!0)};ie.addEventListener("change",(()=>{(()=>{switch(ie.value){case"1":fe(pe,["0","2","3"]),pe[2].selected=!0;break;case"2":fe(pe,["0","3"]),pe[1].selected=!0;break;case"3":fe(pe,["0"]),pe[0].selected=!0;break;case"100":fe(pe,["1","2","3"]),pe[3].selected=!0}})()})),ae.addEventListener("submit",(e=>{var t;e.preventDefault(),(t=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t})).then(ee).catch(te)})),ae.querySelector(".ad-form__reset").addEventListener("click",(e=>{e.preventDefault(),Z(),re((e=>{P(e)}))}))})();
//# sourceMappingURL=main.bundle.js.map